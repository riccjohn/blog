---
import BaseHead from '@/components/BaseHead.astro'
import Header from '@/components/Header.astro'
import Footer from '@/components/Footer.astro'
import { SITE_TITLE, SITE_DESCRIPTION } from '@/consts'
import { getCollection } from 'astro:content'
import FormattedDate from '@/components/FormattedDate.astro'

const posts = (await getCollection('blog')).sort(
    (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
)
---

<!doctype html>
<html lang="en">
    <head>
        <script is:inline>
            // Initialize theme before any rendering to prevent FOUC
            const storedTheme = localStorage.getItem('theme-preference')
            const systemPrefersDark = window.matchMedia(
                '(prefers-color-scheme: dark)'
            ).matches
            const theme = storedTheme || (systemPrefersDark ? 'dark' : 'light')
            if (theme === 'dark') {
                document.documentElement.classList.add('dark')
            } else {
                document.documentElement.classList.remove('dark')
            }
        </script>
        <BaseHead title={SITE_TITLE} description={SITE_DESCRIPTION} />
    </head>
    <body>
        <Header />
        <main class="blog-grid-width">
            <section>
                <ul class="m-0 flex list-none flex-wrap gap-8 p-0 max-md:gap-2">
                    {
                        posts.map((post, index) => (
                            <li
                                class:list={[
                                    'w-[calc(50%-1rem)] max-md:w-full max-md:text-center',
                                    index === 0 &&
                                        'mb-4 w-full text-center max-md:mb-0',
                                ]}
                            >
                                <a
                                    href={`/blog/${post.id}/`}
                                    class="group block [&>*]:no-underline [&>*]:transition-all [&>*]:duration-200"
                                >
                                    <img
                                        class:list={[
                                            'border-border-default group-hover:border-accent-primary mb-2 rounded-xl border group-hover:shadow-[0_0_0_2px_var(--color-accent-muted)]',
                                            index === 0 && 'w-full',
                                        ]}
                                        width={720}
                                        height={360}
                                        src={post.data.heroImage}
                                        alt=""
                                    />
                                    <h4
                                        class:list={[
                                            'title text-text-heading group-hover:text-accent-primary m-0 leading-none',
                                            index === 0 &&
                                                'text-[2.369rem] max-md:text-[1.563rem]',
                                        ]}
                                    >
                                        {post.data.title}
                                    </h4>
                                    <p class="date text-text-secondary group-hover:text-accent-primary m-0">
                                        <FormattedDate
                                            date={post.data.pubDate}
                                        />
                                    </p>
                                </a>
                            </li>
                        ))
                    }
                </ul>
            </section>
        </main>
        <Footer />
    </body>
</html>
